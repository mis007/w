<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>低配版语音对话系统示例 - GLM-4.5-Flash</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
        }
        
        .config-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 5px;
            background-color: #fafafa;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        button {
            background-color: #007AFF;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            background-color: #0056cc;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            text-align: center;
        }
        
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007AFF;
        }
        
        .code-block {
            background-color: #f1f1f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .api-key-warning {
            color: #856404;
            background-color: #fff3cd;
            border-color: #ffeaa7;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>低配版语音对话系统示例</h1>
        <p>本示例演示如何使用智谱AI的GLM-4.5-Flash模型构建低成本语音对话系统</p>
        
        <div class="api-key-warning">
            <strong>注意：</strong>请先在下方输入您的智谱AI API密钥以进行测试
        </div>
        
        <div class="config-section">
            <h2>配置设置</h2>
            
            <div class="form-group">
                <label for="api-key">API密钥 *</label>
                <input type="password" id="api-key" placeholder="请输入您的智谱AI API密钥">
            </div>
            
            <div class="form-group">
                <label for="model">模型</label>
                <select id="model">
                    <option value="glm-4.5-flash" selected>GLM-4.5-Flash (推荐)</option>
                    <option value="glm-4">GLM-4</option>
                    <option value="glm-3-turbo">GLM-3-Turbo</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="system-prompt">系统提示词</label>
                <textarea id="system-prompt" rows="3">你是一个智能语音助手，请用简洁明了的语言回答用户问题。回答要口语化，适合语音播报。</textarea>
            </div>
            
            <div class="form-group">
                <label for="thinking-mode">思考模式</label>
                <select id="thinking-mode">
                    <option value="enabled" selected>启用深度思考</option>
                    <option value="disabled">禁用深度思考</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="test-input">测试输入</label>
                <textarea id="test-input" rows="3" placeholder="请输入测试文本，例如：你好，今天天气怎么样？">你好，今天天气怎么样？</textarea>
            </div>
            
            <button id="validate-btn">验证API密钥</button>
            <button id="test-btn" disabled>测试模型调用</button>
            <button id="clear-btn">清空结果</button>
        </div>
        
        <div id="status" class="status" style="display: none;"></div>
        
        <div id="result" class="result" style="display: none;">
            <h3>调用结果</h3>
            <div id="result-content"></div>
        </div>
        
        <div class="config-section">
            <h2>集成代码示例</h2>
            <p>以下是在低配版语音对话系统中集成GLM-4.5-Flash模型的代码示例：</p>
            
            <div class="code-block">
<pre>// 1. 配置对象
const config = {
    apiKey: 'your-api-key',
    model: 'glm-4.5-flash',
    systemPrompt: '你是一个智能语音助手...',
    thinkingMode: 'enabled'
};

// 2. 调用模型处理文本
async function processUserText(userText, history = []) {
    const response = await fetch('https://open.bigmodel.cn/api/paas/v4/chat/completions', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${config.apiKey}`
        },
        body: JSON.stringify({
            model: config.model,
            messages: [
                { role: "system", content: config.systemPrompt },
                ...history,
                { role: "user", content: userText }
            ],
            thinking: {
                type: config.thinkingMode
            }
        })
    });
    
    const data = await response.json();
    return data.choices[0].message.content;
}

// 3. 在语音对话流程中使用
async function handleVoiceInput(base64Audio) {
    // 第一步：STT转换
    const sttResult = await sttConvert(base64Audio);
    
    // 第二步：模型处理
    const modelResponse = await processUserText(sttResult);
    
    // 第三步：TTS播放
    speakText(modelResponse);
}
</pre>
            </div>
        </div>
    </div>

    <script>
        // DOM元素
        const apiKeyInput = document.getElementById('api-key');
        const modelSelect = document.getElementById('model');
        const systemPromptTextarea = document.getElementById('system-prompt');
        const thinkingModeSelect = document.getElementById('thinking-mode');
        const testInputTextarea = document.getElementById('test-input');
        const validateBtn = document.getElementById('validate-btn');
        const testBtn = document.getElementById('test-btn');
        const clearBtn = document.getElementById('clear-btn');
        const statusDiv = document.getElementById('status');
        const resultDiv = document.getElementById('result');
        const resultContent = document.getElementById('result-content');
        
        // 显示状态消息
        function showStatus(message, type = 'info') {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
            
            // 3秒后自动隐藏成功消息
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            }
        }
        
        // 隐藏状态消息
        function hideStatus() {
            statusDiv.style.display = 'none';
        }
        
        // 显示结果
        function showResult(content) {
            resultContent.innerHTML = content;
            resultDiv.style.display = 'block';
        }
        
        // 隐藏结果
        function hideResult() {
            resultDiv.style.display = 'none';
        }
        
        // 验证API密钥
        async function validateApiKey() {
            const apiKey = apiKeyInput.value.trim();
            
            if (!apiKey) {
                showStatus('请输入API密钥', 'error');
                return;
            }
            
            showStatus('正在验证API密钥...', 'info');
            validateBtn.disabled = true;
            
            try {
                const response = await fetch('https://open.bigmodel.cn/api/paas/v4/models', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });
                
                if (response.ok) {
                    showStatus('API密钥验证成功！现在可以测试模型调用', 'success');
                    testBtn.disabled = false;
                } else {
                    showStatus(`API密钥验证失败: ${response.status} ${response.statusText}`, 'error');
                    testBtn.disabled = true;
                }
            } catch (error) {
                showStatus(`验证过程中发生错误: ${error.message}`, 'error');
                testBtn.disabled = true;
            } finally {
                validateBtn.disabled = false;
            }
        }
        
        // 测试模型调用
        async function testModelCall() {
            const apiKey = apiKeyInput.value.trim();
            const model = modelSelect.value;
            const systemPrompt = systemPromptTextarea.value;
            const thinkingMode = thinkingModeSelect.value;
            const testInput = testInputTextarea.value.trim();
            
            if (!apiKey) {
                showStatus('请输入API密钥', 'error');
                return;
            }
            
            if (!testInput) {
                showStatus('请输入测试文本', 'error');
                return;
            }
            
            showStatus('正在调用模型...', 'info');
            testBtn.disabled = true;
            
            try {
                const startTime = Date.now();
                
                const response = await fetch('https://open.bigmodel.cn/api/paas/v4/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [
                            { role: "system", content: systemPrompt },
                            { role: "user", content: testInput }
                        ],
                        thinking: {
                            type: thinkingMode
                        },
                        temperature: 0.7,
                        max_tokens: 2048
                    })
                });
                
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                if (response.ok) {
                    const data = await response.json();
                    const modelResponse = data.choices[0].message.content;
                    
                    const resultHtml = `
                        <p><strong>输入文本：</strong>${testInput}</p>
                        <p><strong>模型回复：</strong>${modelResponse}</p>
                        <p><strong>调用耗时：</strong>${duration}ms</p>
                        <p><strong>使用的模型：</strong>${model}</p>
                        <p><strong>思考模式：</strong>${thinkingMode === 'enabled' ? '启用' : '禁用'}</p>
                    `;
                    
                    showResult(resultHtml);
                    showStatus('模型调用成功！', 'success');
                } else {
                    const errorText = await response.text();
                    showStatus(`模型调用失败: ${response.status} ${response.statusText} - ${errorText}`, 'error');
                }
            } catch (error) {
                showStatus(`调用过程中发生错误: ${error.message}`, 'error');
            } finally {
                testBtn.disabled = false;
            }
        }
        
        // 清空结果
        function clearResults() {
            hideStatus();
            hideResult();
            testInputTextarea.value = '';
        }
        
        // 事件监听器
        validateBtn.addEventListener('click', validateApiKey);
        testBtn.addEventListener('click', testModelCall);
        clearBtn.addEventListener('click', clearResults);
        
        // API密钥输入时自动启用测试按钮（简化操作）
        apiKeyInput.addEventListener('input', () => {
            if (apiKeyInput.value.trim()) {
                testBtn.disabled = false;
            } else {
                testBtn.disabled = true;
            }
        });
        
        // 页面加载完成提示
        document.addEventListener('DOMContentLoaded', () => {
            showStatus('请输入您的智谱AI API密钥开始测试', 'info');
        });
    </script>
</body>
</html>